{% extends "index.html" %}
{% block input %}

    <!-- main -->
    <div class="content-section">

        <!-- input validation error message -->
        {% if not valid %}
            <section style="background-color:maroon;">
                <h3 style="margin-left:25px; color:white;"> {{ error }} </h3>
            </section>
        {% endif %}

        <!-- main form -->
        <form id="input-form" method="POST" action="">
        
            <!-- security tag? -->
            {{ in_form.hidden_tag() }}           

            <!-- camera section -->
            <section name="camera" class="container">

                <h2 class="block">Camera Parameters</h2> 
        
                <div class="block">
                    <form name="camera" method="POST" action="">
                        {{ select_form.csrf_token }}{{ select_form.camera }}
                    </form>
                </div>

                <div class="block">
                    <div class="tooltip">â“˜
                        <span class="tooltiptext">test</span>
                    </div>
                </div>

                <div class="myDIV">Hover over me.</div>
                
                
                <!--div class="spacer"></div--><div class="spacer"></div><div class="spacer-break"></div>

                <div class="block">
                    {% if in_form.sensor_x.errors %}
                    {{ in_form.sensor_x.label(type="autofill", class="myDiv") }}{{ in_form.sensor_x(style="border-color: red;") }}
                     {% else %}
                         {{ in_form.sensor_x.label(type="autofill") }}{{ in_form.sensor_x(class="myDiv") }}
                         <div class="hide">I am shown when someone hovers over the div above.</div>
                     {% endif %}
                </div>

                <div class="block">
                    {% if in_form.sensor_y.errors %}
                        {{ in_form.sensor_y.label(type="autofill") }}{{ in_form.sensor_y(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.sensor_y.label(type="autofill") }}{{ in_form.sensor_y }}
                    {% endif %}
                </div>
        
                <div class="block">
                    {% if in_form.px_size.errors %}
                        {{ in_form.px_size.label(type="autofill") }}{{ in_form.px_size(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.px_size.label(type="autofill") }}{{ in_form.px_size }}
                    {% endif %}
                </div>         
                    
                <div class="block"> 
                    {% if in_form.q_efficiency.errors %}
                        {{ in_form.q_efficiency.label(type="autofill") }}{{ in_form.q_efficiency(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.q_efficiency.label(type="autofill") }}{{ in_form.q_efficiency }}
                    {% endif %}
                </div>
                 
                <div class="block">
                    {% if in_form.read_noise.errors %}
                        {{ in_form.read_noise.label(type="autofill") }}{{ in_form.read_noise(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.read_noise.label(type="autofill") }}{{ in_form.read_noise }}
                    {% endif %}
                </div>

                <div class="block">
                    {% if in_form.gain.errors %}
                        {{ in_form.gain.label(type="autofill") }}{{ in_form.gain(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.gain.label(type="autofill") }}{{ in_form.gain }}
                    {% endif %}
                </div>

                <div class="block">
                    
                    {% if in_form.offset.errors %}
                        {{ in_form.offset.label(type="autofill") }}{{ in_form.offset(style="border-color: red;")}}
                    {% else %}
                        {{ in_form.offset.label(type="autofill") }}{{ in_form.offset }}
                    {% endif %}
                </div>  

                <div class="block">
                    {% if in_form.dark_noise.errors %}
                        {{ in_form.dark_noise.label(type="autofill") }}{{ in_form.dark_noise(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.dark_noise.label(type="autofill") }}{{ in_form.dark_noise }}
                    {% endif %}
                </div>

                <div class="block">
                    {% if in_form.full_well.errors %}
                        {{ in_form.full_well.label(type="autofill") }}{{ in_form.full_well(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.full_well.label(type="autofill") }}{{ in_form.full_well }}
                    {% endif %}
                 </div>

                 <div class="spacer"></div>


                <script> 
                    document.getElementById('camera').addEventListener('change', function() {

                        var presets = {{ camera_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actually anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) { preset[i] = ''; }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('camera').value ) { preset = presets[i][1]; }
                        }
                       
                        // autofill the values
                        document.getElementById('sensor_x').value = preset[0];
                        document.getElementById('sensor_y').value = preset[1];
                        document.getElementById('px_size').value = preset[2];
                        document.getElementById('q_efficiency').value = preset[3];
                        document.getElementById('read_noise').value = preset[4];
                        document.getElementById('gain').value = preset[5];
                        document.getElementById('offset').value = preset[6];
                        document.getElementById('dark_noise').value = preset[7];
                        document.getElementById('full_well').value = preset[8];
                    });
                </script>

            </section>

            <!-- telescope section -->
            <section name="telescope" class="container">

                <h2 class="block">Telescope Parameters</h2> 
        
                <div class="block">
                    <form name="telescope" method="POST" action="">
                        {{ select_form.csrf_token }}{{ select_form.telescope }}
                    </form>
                </div>

                <div class="spacer"></div><div class="spacer"></div><div class="spacer-break"></div>


                <div class="block">
                    {% if in_form.scope_dia.errors %}
                        {{ in_form.scope_dia.label(type="autofill") }}{{ in_form.scope_dia(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.scope_dia.label(type="autofill") }}{{ in_form.scope_dia }}
                    {% endif %}
                </div>

                <div class="block">
                    {% if in_form.scope_focal.errors %}
                        {{ in_form.scope_focal.label(type="autofill") }}{{ in_form.scope_focal(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.scope_focal.label(type="autofill") }}{{ in_form.scope_focal }}
                    {% endif %}
                </div>

                <div class="block">
                    {% if in_form.plate_scale.errors %}
                        {{ in_form.plate_scale.label(type="autofill") }}{{ in_form.plate_scale(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.plate_scale.label(type="autofill") }}{{ in_form.plate_scale }}
                    {% endif %}
                </div>


                <div class="spacer"></div>


                <script> 
                    document.getElementById('telescope').addEventListener('change', function() {

                        var presets = {{ telescope_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actually anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) { preset[i] = ''; }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('telescope').value ) { preset = presets[i][1]; }
                        }

                        document.getElementById('scope_dia').value = preset[0];
                        document.getElementById('scope_focal').value = preset[1];
                        document.getElementById('plate_scale').value = preset[2];
                    });
                </script>

            </section>

            <!-- filter section -->
            <section name="filter" class="container">

                <h2 class="block">Filter Parameters</h2> 
        
                <div class="block">
                    <form name="filter" method="POST" action="">
                        {{ select_form.csrf_token }}{{ select_form.filter }}
                    </form>
                </div>

                <div class="spacer"></div><div class="spacer"></div><div class="spacer-break"></div>

                <div class="block"> 
                    {% if in_form.filter_low.errors or error == "Low filter pass cannot be greater than high filter pass"%}
                        {{ in_form.filter_low.label(type="autofill") }}{{ in_form.filter_low(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.filter_low.label(type="autofill") }}{{ in_form.filter_low }}
                    {% endif %}
                </div>

                <div class="block"> 
                    {% if in_form.filter_high.errors or error == "Low filter pass cannot be greater than high filter pass" %}
                        {{ in_form.filter_high.label(type="autofill") }}{{ in_form.filter_high(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.filter_high.label(type="autofill") }}{{ in_form.filter_high }}
                    {% endif %}
                </div>

                <div class="block"> 
                    {% if in_form.filter_zero.errors %}
                        {{ in_form.filter_zero.label(type="autofill") }}{{ in_form.filter_zero(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.filter_zero.label(type="autofill") }}{{ in_form.filter_zero }}
                    {% endif %}
                </div>

                <div class="spacer"></div>
                
                <script> 
                    document.getElementById('filter').addEventListener('change', function() {

                        var presets = {{ filter_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actually anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) { preset[i] = ''; }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('filter').value ) { preset = presets[i][1]; }
                        }

                        document.getElementById('filter_low').value = preset[0];
                        document.getElementById('filter_high').value = preset[1];
                        document.getElementById('filter_zero').value = preset[2];
                    });
                </script>

            </section>

       



            <!-- target section -->
            <section name="target" class="container">

                <h2 class="block">Target Parameters</h2> 

                <div class="block">
                    <form name="target" method="POST" action="">
                        {{ select_form.csrf_token }}{{ select_form.target }}
                    </form>
                </div>
                
                <div class="block">
                    <button class="tab" onclick="Tab(event, 'target-point')" id="defaultOpen">Point Source</button>
                    <button class="tab" onclick="Tab(event, 'target-extended')" id="defaultClose">Extended Source</button> 
                </div><div class="spacer"></div><div class="spacer-break"></div>

                <div class="block">
                    {% if in_form.star_dist.errors %}
                        {{ in_form.star_dist.label(type="autofill") }}{{ in_form.star_dist(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.star_dist.label(type="autofill") }}{{ in_form.star_dist }}
                    {% endif %}
                </div>

                <div class="block">
                    {% if in_form.star_temp.errors %}
                        {{ in_form.star_temp.label(type="autofill") }}{{ in_form.star_temp(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.star_temp.label(type="autofill") }}{{ in_form.star_temp }}
                    {% endif %}
                </div>

                <div class="block">
                    {% if in_form.star_dia_solar.errors %}
                        {{ in_form.star_dia_solar.label(type="autofill") }}{{ in_form.star_dia_solar(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.star_dia_solar.label(type="autofill") }}{{ in_form.star_dia_solar }}
                    {% endif %}
                </div>

                <div class="block">
                    {% if in_form.pickle.errors %}
                        {{ in_form.type.label(type="autofill", style="background-color:gray;") }}{{ in_form.pickle(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.pickle.label(type="autofill", style="background-color:gray;" ) }}{{ in_form.pickle(readonly=true) }}
                    {% endif %}
                </div><div class="spacer"></div><div class="spacer"></div>

                <script> 
                    document.getElementById('target').addEventListener('change', function() {

                        var presets = {{ target_presets|tojson }};
                        var size = presets[0][1].length;
                        var preset = [size]

                        // blank by default
                        for(let i = 0; i < size; i++) { preset[i] = ''; }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('target').value ) { preset = presets[i][1]; }
                        }
                        // autofill
                        document.getElementById('star_temp').value = preset[0];

                        // display source name
                        var e = document.getElementById('target');
                        var text = e.options[e.selectedIndex].text;
                        document.getElementById('pickle').value = text;
                    });


                    function Tab(e, name) {
                        var tab;

                        tab = document.getElementById("defaultOpen");
                        tab.focus();
                    }



                </script>
            </section>

            

            <!-- conditions section -->
            <section name="conditions" class="container">

                <h2 class="block">Condition Parameters</h2> 
        
                <div class="block">
                    <form name="conditions" method="POST" action="">
                        {{ select_form.csrf_token }}{{ select_form.conditions }}
                    </form>
                </div>

                <div class="spacer"></div><div class="spacer"></div><div class="spacer-break"></div>

                <div class="block">
                    {% if in_form.seeing.errors %}
                        {{ in_form.seeing.label(type="autofill") }}{{ in_form.seeing(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.seeing.label(type="autofill") }}{{ in_form.seeing }}
                    {% endif %}
                </div>


                <div class="block">
                    {% if in_form.sqm.errors %}
                        {{ in_form.sqm.label(type="autofill") }}{{ in_form.sqm(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.sqm.label(type="autofill") }}{{ in_form.sqm }}
                    {% endif %}
                </div>
        
                <div class="block">
                    <!-- GAO autofill button -->
                    <input type="radio" id="sky_bright">Fill from GAO<br>
                </div>
                <div class="spacer"></div>
           
                <script> 
                    document.getElementById('conditions').addEventListener('change', function() {

                        var selectedOption = this.value;
                        document.getElementById('seeing').value = selectedOption;
                    });
                </script>

                <script> 
                    document.getElementById('sky_bright').addEventListener('change', function() {

                        var option = {{ gao_sqm|tojson }}
                        document.getElementById('sqm').value = option;
                    });
                </script>

            </section>

            <!-- SNR section -->
            <section name="snr" class="container">

                <h2>Signal to Noise</h2><div class="spacer"></div><div class="spacer"></div>

                

                <div class="block">

                    {% if in_form.desired_snr.errors %}
                        {{ in_form.desired_snr.label(type="autofill") }}{{ in_form.desired_snr(style="border-color: red;") }}
                    {% else %}
                        {{ in_form.desired_snr.label(type="autofill") }}{{ in_form.desired_snr }}
                    {% endif %}

                </div><div class="spacer"></div><div class="spacer"></div>

            </section>

            <!-- submit form -->
            <section id="submission" class="container">
                {{ in_form.submit(class="btn btn-outline-info", style="background-color: teal") }} 
          </section>
          
            
        </form>        

    </div>

{% endblock input %}