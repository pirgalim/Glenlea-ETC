{% extends "index.html" %}
{% block input %}

    <!-- main -->
    <div class="content-section">

        <!-- preset menu -->
        <section class="preset-selection">

            <h2>Load Presets</h2>

            <form name="camera" method="POST" action="">
                {{ select_form.csrf_token }}
                {{ select_form.camera.label }} {{ select_form.camera }}
            </form>

            <form name="telescope" method="POST" action="">
                {{ select_form.csrf_token }}
                {{ select_form.telescope.label }} {{ select_form.telescope }}
            </form>

            <form name="filter" method="POST" action="">
                {{ select_form.csrf_token }}
                {{ select_form.filter.label }} {{ select_form.filter }}
            </form>

            <form name="target" method="POST" action="">
                {{ select_form.csrf_token }}
                {{ select_form.target.label }} {{ select_form.target }}
            </form>

            <form name="conditions" method="POST" action="">
                {{ select_form.csrf_token }}
                {{ select_form.conditions.label }} {{ select_form.conditions }}
            </form>
            
        </section>

        <!-- input validation error message -->
        {% if not valid %}
            <section style="background-color:maroon;">
                <h3 style="margin-left:25px; color:white;"> {{ error }} </h3>
            </section>
        {% endif %}

        <!-- main form -->
        <form id="input-form" method="POST" action="">
        
            <!-- security tag? -->
            {{ in_form.hidden_tag() }}

            <!-- camera section -->
            <section id="camera">

                <h2>Camera Parameters</h2> 
                            
                {% if in_form.sensor_x.errors %}
                    {{ in_form.sensor_x.label(type="autofill") }}{{ in_form.sensor_x(style="border-color: red;") }}
                {% else %}
                    {{ in_form.sensor_x.label(type="autofill") }}{{ in_form.sensor_x }} 
                {% endif %}

                {% if in_form.sensor_y.errors %}
                    {{ in_form.sensor_y.label(type="autofill") }}{{ in_form.sensor_y(style="border-color: red;") }}
                {% else %}
                    {{ in_form.sensor_y.label(type="autofill") }}{{ in_form.sensor_y }}
                {% endif %}

                {% if in_form.px_size.errors %}
                    {{ in_form.px_size.label(type="autofill") }}{{ in_form.px_size(style="border-color: red;") }}
                {% else %}
                    {{ in_form.px_size.label(type="autofill") }}{{ in_form.px_size }}
                {% endif %}

                <br>
        
                {% if in_form.q_efficiency.errors %}
                    {{ in_form.q_efficiency.label(type="autofill") }}{{ in_form.q_efficiency(style="border-color: red;") }}
                {% else %}
                    {{ in_form.q_efficiency.label(type="autofill") }}{{ in_form.q_efficiency }}
                {% endif %}

                {% if in_form.read_noise.errors %}
                    {{ in_form.read_noise.label(type="autofill") }}{{ in_form.read_noise(style="border-color: red;") }}
                {% else %}
                    {{ in_form.read_noise.label(type="autofill") }}{{ in_form.read_noise }}
                {% endif %}

                {% if in_form.gain.errors %}
                    {{ in_form.gain.label(type="autofill") }}{{ in_form.gain(style="border-color: red;") }}
                {% else %}
                    {{ in_form.gain.label(type="autofill") }}{{ in_form.gain }}
                {% endif %}
                
                <br>

                {% if in_form.offset.errors %}
                    {{ in_form.offset.label(type="autofill") }}{{ in_form.offset(style="border-color: red;")}}
                {% else %}
                    {{ in_form.offset.label(type="autofill") }}{{ in_form.offset }}
                {% endif %}

                {% if in_form.dark_noise.errors %}
                    {{ in_form.dark_noise.label(type="autofill") }}{{ in_form.dark_noise(style="border-color: red;") }}
                {% else %}
                    {{ in_form.dark_noise.label(type="autofill") }}{{ in_form.dark_noise }}
                {% endif %}

                {% if in_form.full_well.errors %}
                    {{ in_form.full_well.label(type="autofill") }}{{ in_form.full_well(style="border-color: red;") }}
                {% else %}
                    {{ in_form.full_well.label(type="autofill") }}{{ in_form.full_well }}
                {% endif %}
        
                <script> 
                    document.getElementById('camera').addEventListener('change', function() {

                        var presets = {{ camera_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actually anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) { preset[i] = ''; }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('camera').value ) { preset = presets[i][1]; }
                        }
                       
                        // autofill the values
                        document.getElementById('sensor_x').value = preset[0];
                        document.getElementById('sensor_y').value = preset[1];
                        document.getElementById('px_size').value = preset[2];
                        document.getElementById('q_efficiency').value = preset[3];
                        document.getElementById('read_noise').value = preset[4];
                        document.getElementById('gain').value = preset[5];
                        document.getElementById('offset').value = preset[6];
                        document.getElementById('dark_noise').value = preset[7];
                        document.getElementById('full_well').value = preset[8];
                    });
                </script>

            </section>

            <!-- telescope section -->
            <section id="telescope">

                <h2>Telescope Parameters</h2>

                {% if in_form.scope_dia.errors %}
                    {{ in_form.scope_dia.label(type="autofill") }}{{ in_form.scope_dia(style="border-color: red;") }}
                {% else %}
                    {{ in_form.scope_dia.label(type="autofill") }}{{ in_form.scope_dia }}
                {% endif %}

                {% if in_form.scope_focal.errors %}
                    {{ in_form.scope_focal.label(type="autofill") }}{{ in_form.scope_focal(style="border-color: red;") }}
                {% else %}
                    {{ in_form.scope_focal.label(type="autofill") }}{{ in_form.scope_focal }}
                {% endif %}

                {% if in_form.plate_scale.errors %}
                    {{ in_form.plate_scale.label(type="autofill") }}{{ in_form.plate_scale(style="border-color: red;") }}
                {% else %}
                    {{ in_form.plate_scale.label(type="autofill") }}{{ in_form.plate_scale }}
                {% endif %}

                <script> 
                    document.getElementById('telescope').addEventListener('change', function() {

                        var presets = {{ telescope_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actually anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) { preset[i] = ''; }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('telescope').value ) { preset = presets[i][1]; }
                        }

                        document.getElementById('scope_dia').value = preset[0];
                        document.getElementById('scope_focal').value = preset[1];
                        document.getElementById('plate_scale').value = preset[2];
                    });
                </script>

            </section>

            <!-- filter section -->
            <section id="filter">

                <h2>Filter Parameters</h2>

                {% if in_form.filter_low.errors or error == "Low filter pass cannot be greater than high filter pass"%}
                    {{ in_form.filter_low.label(type="autofill") }}{{ in_form.filter_low(style="border-color: red;") }}
                {% else %}
                    {{ in_form.filter_low.label(type="autofill") }}{{ in_form.filter_low }}
                {% endif %}

                {% if in_form.filter_high.errors or error == "Low filter pass cannot be greater than high filter pass" %}
                    {{ in_form.filter_high.label(type="autofill") }}{{ in_form.filter_high(style="border-color: red;") }}
                {% else %}
                    {{ in_form.filter_high.label(type="autofill") }}{{ in_form.filter_high }}
                {% endif %}

                {% if in_form.filter_zero.errors %}
                    {{ in_form.filter_zero.label(type="autofill") }}{{ in_form.filter_zero(style="border-color: red;") }}
                {% else %}
                    {{ in_form.filter_zero.label(type="autofill") }}{{ in_form.filter_zero }}
                {% endif %}
                
                <script> 
                    document.getElementById('filter').addEventListener('change', function() {

                        var presets = {{ filter_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actually anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) { preset[i] = ''; }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('filter').value ) { preset = presets[i][1]; }
                        }

                        document.getElementById('filter_low').value = preset[0];
                        document.getElementById('filter_high').value = preset[1];
                        document.getElementById('filter_zero').value = preset[2];
                    });
                </script>

            </section>

            <!-- target section -->
            <section id="target">

                <h2>Target Parameters</h2>

                 {% if in_form.star_dist.errors %}
                    {{ in_form.star_dist.label(type="autofill") }}{{ in_form.star_dist(style="border-color: red;") }}
                {% else %}
                    {{ in_form.star_dist.label(type="autofill") }}{{ in_form.star_dist }}
                {% endif %}

                {% if in_form.star_temp.errors %}
                    {{ in_form.star_temp.label(type="autofill") }}{{ in_form.star_temp(style="border-color: red;") }}
                {% else %}
                    {{ in_form.star_temp.label(type="autofill") }}{{ in_form.star_temp }}
                {% endif %}

                {% if in_form.star_dia_solar.errors %}
                    {{ in_form.star_dia_solar.label(type="autofill") }}{{ in_form.star_dia_solar(style="border-color: red;") }}
                {% else %}
                    {{ in_form.star_dia_solar.label(type="autofill") }}{{ in_form.star_dia_solar }}
                {% endif %}

                <script> 
                    document.getElementById('target').addEventListener('change', function() {

                        var presets = {{ target_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actually anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) { preset[i] = ''; }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('target').value ) { preset = presets[i][1]; }
                        }

                        document.getElementById('star_dist').value = preset[0];
                        document.getElementById('star_temp').value = preset[1];
                        document.getElementById('star_dia_solar').value = preset[2];
                    });
                </script>

            </section>

            <!-- conditions section -->
            <section id="conditions">

                <h2>Conditions</h2>

                {% if in_form.seeing.errors %}
                    {{ in_form.seeing.label(type="autofill") }}{{ in_form.seeing(style="border-color: red;") }}
                {% else %}
                    {{ in_form.seeing.label(type="autofill") }}{{ in_form.seeing }}
                {% endif %}

                {% if in_form.sqm.errors %}
                    {{ in_form.sqm.label(type="autofill") }}{{ in_form.sqm(style="border-color: red;") }}
                {% else %}
                    {{ in_form.sqm.label(type="autofill") }}{{ in_form.sqm }}
                {% endif %}
        
                <!-- GAO autofill button -->
                <input type="radio" id="sky_bright">Fill from GAO<br>
           
                <script> 
                    document.getElementById('conditions').addEventListener('change', function() {

                        var selectedOption = this.value;
                        document.getElementById('seeing').value = selectedOption;
                    });
                </script>

                <script> 
                    document.getElementById('sky_bright').addEventListener('change', function() {

                        var option = {{ gao_sqm|tojson }}
                        document.getElementById('sqm').value = option;
                    });
                </script>

            </section>

            <!-- SNR section -->
            <section id="snr">

                <h2>Signal to Noise</h2>

                {% if in_form.desired_snr.errors %}
                    {{ in_form.desired_snr.label(type="autofill") }}{{ in_form.desired_snr(style="border-color: red;") }}
                {% else %}
                    {{ in_form.desired_snr.label(type="autofill") }}{{ in_form.desired_snr }}
                {% endif %}

            </section>

            <!-- submit form -->
            <section id="submission">
                {{ in_form.submit(class="btn btn-outline-info") }} 
          </section>
          
            
        </form>        

    </div>

{% endblock input %}