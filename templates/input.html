{% extends "index.html" %}
{% block content %}

    <div class="content-section">


        <section class="preset-selection">

            <h2>Load Presets</h2>

            <form name="camera" method="POST" action="">

                {{ camera_select.csrf_token }}
                {{ camera_select.camera.label }} {{ camera_select.camera }}
    
            </form>

            <br>

            <form name="telescope" method="POST" action="">

                {{ telescope_select.csrf_token }}
                {{ telescope_select.telescope.label }} {{ telescope_select.telescope }}
       
            </form>
            

        </section>

        
        

        <!--{% if not valid %}

            <section style="background-color:red;">
                <h3 style="margin-left: 25px;">Input is invalid</h3>
            </section>
            
        {% endif %}-->


        <form method="POST" action="">
        
            {{ in_form.hidden_tag() }}
                
            <section id="camera">

                <h2>Camera Parameters</h2>

                <span>Dimensions</span>{{ in_form.sensor_x(class="form-control form-control-lg") }}<span>x</span>{{ in_form.sensor_y(class="form-control form-control-lg") }}

                <label>{{ in_form.px_size.label }}</label>{{ in_form.px_size(type="autofill") }} <br>
        
                <span>{{ in_form.q_efficiency.label(class="form-control-label") }}</span>{{ in_form.q_efficiency(class="form-control form-control-lg") }}

                <span>{{ in_form.read_noise.label(class="form-control-label") }}</span>{{ in_form.read_noise(class="form-control form-control-lg") }}

                <span>{{ in_form.gain.label(class="form-control-label") }}</span>{{ in_form.gain(class="form-control form-control-lg") }} <br>

                <span>{{ in_form.offset.label(class="form-control-label") }}</span>{{ in_form.offset(class="form-control form-control-lg") }}

                <span>{{ in_form.dark_noise.label(class="form-control-label") }}</span>{{ in_form.dark_noise(class="form-control form-control-lg") }}

                <span>{{ in_form.full_well.label(class="form-control-label") }}</span>{{ in_form.full_well(class="form-control form-control-lg") }}<br>
        

                <script> 
                    document.getElementById('camera').addEventListener('change', function() {

                        var presets = {{ camera_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actaully anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) {
                            preset[i] = '';
                        }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('camera').value ) {
                                preset = presets[i][1];
                            }
                        }
                       
            

                        document.getElementById('sensor_x').value = preset[0];
                        document.getElementById('sensor_y').value = preset[1];
                        document.getElementById('px_size').value = preset[2];
                        document.getElementById('q_efficiency').value = preset[3];
                        document.getElementById('read_noise').value = preset[4];
                        document.getElementById('gain').value = preset[5];
                        document.getElementById('offset').value = preset[6];
                        document.getElementById('dark_noise').value = preset[7];
                        document.getElementById('full_well').value = preset[8];
                    });
                </script>
                
        
            </section>               


            <section id="telescope">

                <h2>Telescope Parameters</h2>

                
                <span>{{ in_form.scope_dia.label(class="form-control-label") }}</span>{{ in_form.scope_dia(class="form-control form-control-lg") }}<br>

                <span>{{ in_form.scope_focal.label(class="form-control-label") }}</span>{{ in_form.scope_focal(class="form-control form-control-lg") }}<br>

                <span>{{ in_form.plate_scale.label(class="form-control-label") }}</span>{{ in_form.plate_scale(class="form-control form-control-lg") }}<br>
        

                <script> 
                    document.getElementById('telescope').addEventListener('change', function() {

                        var presets = {{ telescope_presets|tojson }};
                        var size = presets[0][1].length;

                        // I should check if there is actaully anything here first
                        var preset = [size]

                        for(let i = 0; i < size; i++) {
                            preset[i] = '';
                        }

                        // match the selection with a preset
                        for( let i = 0; i < presets.length; i++ ) {
                            if( presets[i][0] == document.getElementById('telescope').value ) {
                                preset = presets[i][1];
                            }
                        }

                        document.getElementById('scope_dia').value = preset[0];
                        document.getElementById('scope_focal').value = preset[1];
                        document.getElementById('plate_scale').value = preset[2];
                        
                    });
                </script>

            </section>
            
            <section id="submission">
                {{ in_form.submit(class="btn btn-outline-info") }} 
          </section>
            
                
        </form>

    </div>


    

{% endblock content %}
